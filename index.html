<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Spicy Library Pi</title>

<!-- Pi SDK -->
<script src="https://sdk.minepi.com/pi-sdk.js"></script>

<style>
body{
  background:#111;
  color:#fff;
  font-family:Arial;
  margin:0;
  padding:20px;
  text-align:center;
}
button{
  padding:10px 20px;
  font-size:16px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  background:#ff4500;
  color:white;
}
button:disabled{
  background:#555;
  cursor:not-allowed;
}
.hidden{display:none;}
.books-container{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  margin-top:20px;
}
.book{
  border:1px solid #333;
  margin:15px;
  padding:15px;
  border-radius:8px;
  background:#1c1c1c;
  width:220px;
}
.book img{
  width:200px;
  height:auto;
  margin-bottom:10px;
}
</style>
</head>
<body>

<!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="loginScreen">
  <h1>ğŸŒ¶ï¸ Spicy Library</h1>
  <p>Login with Pi Network</p>
  <button id="loginBtn">Login with Pi</button>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„ÙƒØªØ¨ Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="booksScreen" class="hidden">
  <h2 id="welcome"></h2>
  <div class="books-container" id="booksContainer"></div>
  <button onclick="logout()">Logout</button>
</div>

<script>
// =================== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØªØ¨ ===================
const books = [
  { title: "Love Story", author: "Asmanour", pricePi: 5, cover: "cover1.jpg", description: "A hidden childhood love grows into an eternal romance after many trials and tears." },
  { title: "Adventure Tales", author: "John Doe", pricePi: 3, cover: "cover2.jpg", description: "Exciting adventures full of mystery, courage, and unforgettable journeys." },
  { title: "Tech & Web3", author: "Jane Smith", pricePi: 7, cover: "cover3.jpg", description: "Discover the future of blockchain, cryptocurrencies, and decentralized technology." }
];

// =================== ØªÙ‡ÙŠØ¦Ø© Pi SDK ===================
Pi.init({ version:"2.0", sandbox:true }); // Ù„Ø§Ø­Ù‚Ù‹Ø§ ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ± sandbox=false

let currentUser = null;

// =================== ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¯Ø®ÙˆÙ„ ===================
document.getElementById("loginBtn").addEventListener("click", async function(){
  this.disabled = true;
  this.innerText = "Please wait...";
  try {
    const auth = await Pi.authenticate(["username","payments"]);
    currentUser = auth.user;
    showBooksScreen();
  } catch(err){
    alert("Login failed");
    console.error(err);
    this.disabled = false;
    this.innerText = "Login with Pi";
  }
});

// =================== Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„ÙƒØªØ¨ ===================
function showBooksScreen(){
  document.getElementById("loginScreen").classList.add("hidden");
  document.getElementById("booksScreen").classList.remove("hidden");
  document.getElementById("welcome").innerText = "Welcome " + currentUser.username;

  renderBooks();
}

// =================== Ø¹Ø±Ø¶ Ø§Ù„ÙƒØªØ¨ ===================
function renderBooks(){
  const container = document.getElementById("booksContainer");
  container.innerHTML = "";
  books.forEach((book,index)=>{
    const bookDiv = document.createElement("div");
    bookDiv.className = "book";
    bookDiv.innerHTML = `
      <img src="${book.cover}" alt="${book.title}">
      <h3>${book.title}</h3>
      <p>Author: ${book.author}</p>
      <p>Price: ${book.pricePi} Pi</p>
      <button onclick="buyBook(${index})">Buy with Pi</button>
    `;
    container.appendChild(bookDiv);
  });
}

// =================== Ø§Ù„Ø¯ÙØ¹ ===================
async function buyBook(index){
  if(!currentUser){
    alert("You must login first");
    return;
  }
  const book = books[index];
  try {
    // Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± Pi Wallet
    await Pi.createPayment({
      amount: book.pricePi,
      currency: "Pi",
      memo: "Buy " + book.title,
      metadata: { book: book.title }
    },{
      // Ø¹Ù†Ø¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¯ÙØ¹ Ù„Ù„Ù…ÙˆØ§ÙÙ‚Ø©
      onReadyForServerApproval: function(paymentId){
        console.log("Ready for approval:", paymentId);
      },
      // Ø¹Ù†Ø¯ Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø¯ÙØ¹
      onReadyForServerCompletion: function(paymentId, txId){
        alert("Payment successful! ğŸ“¦ You bought '" + book.title + "' (Sandbox)");
      },
      onCancel: function(){
        alert("Payment canceled âŒ");
      },
      onError: function(err){
        alert("Payment error âš ï¸");
        console.error(err);
      }
    });
  } catch(err){
    console.error(err);
    alert("Payment failed");
  }
}

// =================== ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ ===================
function logout(){
  currentUser = null;
  document.getElementById("booksScreen").classList.add("hidden");
  document.getElementById("loginScreen").classList.remove("hidden");
  document.getElementById("loginBtn").disabled = false;
  document.getElementById("loginBtn").innerText = "Login with Pi";
}
</script>

</body>
</html>
